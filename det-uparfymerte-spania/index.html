<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Det uparfymerte Spania - Chris K. N.</title><meta name="description" content="Det er en mørk ironi i at et skip kalt Prestige skulle gi Galicia så hard medfart, for hvis det er en ting du ikke kommer til å se mye av i den spanske regionen, så er det nettopp prestisje, eller alt det innebærer av&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script defer="defer" type="gdpr-blocker/Analytics" data-domain="christian.nordtomme.com" src="https://plausible.io/js/plausible.js"></script><link rel="canonical" href="https://christian.nordtomme.com/det-uparfymerte-spania/"><link rel="alternate" type="application/atom+xml" href="https://christian.nordtomme.com/feed.xml"><link rel="alternate" type="application/json" href="https://christian.nordtomme.com/feed.json"><meta property="og:title" content="Det uparfymerte Spania"><meta property="og:image" content="https://christian.nordtomme.com/media/posts/14/Galicia7.jpg"><meta property="og:image:width" content="275"><meta property="og:image:height" content="400"><meta property="og:site_name" content="Chris K. N."><meta property="og:description" content="Det er en mørk ironi i at et skip kalt Prestige skulle gi Galicia så hard medfart, for hvis det er en ting du ikke kommer til å se mye av i den spanske regionen, så er det nettopp prestisje, eller alt det innebærer av&hellip;"><meta property="og:url" content="https://christian.nordtomme.com/det-uparfymerte-spania/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@nordtomme"><meta name="twitter:title" content="Det uparfymerte Spania"><meta name="twitter:description" content="Det er en mørk ironi i at et skip kalt Prestige skulle gi Galicia så hard medfart, for hvis det er en ting du ikke kommer til å se mye av i den spanske regionen, så er det nettopp prestisje, eller alt det innebærer av&hellip;"><meta name="twitter:image" content="https://christian.nordtomme.com/media/posts/14/Galicia7.jpg"><link rel="stylesheet" href="https://christian.nordtomme.com/assets/css/style.css?v=4552bcf67384bb346e427f6ab62513d8"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://christian.nordtomme.com/det-uparfymerte-spania/"},"headline":"Det uparfymerte Spania","datePublished":"2002-10-01T03:22","dateModified":"2023-09-13T09:40","image":{"@type":"ImageObject","url":"https://christian.nordtomme.com/media/posts/14/Galicia7.jpg","height":400,"width":275},"description":"Det er en mørk ironi i at et skip kalt Prestige skulle gi Galicia så hard medfart, for hvis det er en ting du ikke kommer til å se mye av i den spanske regionen, så er det nettopp prestisje, eller alt det innebærer av&hellip;","author":{"@type":"Person","name":"Chris K. N.","url":"https://christian.nordtomme.com/authors/chris-k-n/"},"publisher":{"@type":"Organization","name":"Chris K. N."}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://christian.nordtomme.com/">Chris K. N.</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://christian.nordtomme.com/tags/norwegian/" target="_self">Innlegg på norsk</a></li><li><a href="https://christian.nordtomme.com/tags/english/" target="_self">Posts in English</a></li></ul></nav></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://christian.nordtomme.com/media/posts/14/Galicia7.jpg" loading="eager" height="400" width="275" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2002-10-01T03:22">October 1, 2002</time></div><h1>Det uparfymerte Spania</h1><div class="post__meta post__meta--author"><a href="https://christian.nordtomme.com/authors/chris-k-n/" class="feed__author">Chris K. N.</a></div></div></header></div><div class="wrapper post__entry"><div class="ingress"><p><em>Det er en mørk ironi i at et skip kalt Prestige skulle gi Galicia så hard medfart, for hvis det er en ting du ikke kommer til å se mye av i den spanske regionen, så er det nettopp prestisje, eller alt det innebærer av pretensjoner og påtatthet.</em></p></div><p>”De kaller Vigo en by,” hvisker en museumsguide om Galicias kommersielle hovedstad. ”Men det er det jo ikke. Vigo er en utpreget landsby. Folk her smiler til og snakker med fremmede. De snakker til og med gallego – galisisk – med hverandre som om de var bønder, og ikke castillansk, slik man gjør i andre spanske byer. Innbyggerne i Vigo oppfører seg provinsielt og da spiller det ingen rolle hvor mange som bor her.”</p><h3>En eim av ekthet</h3><p>Guiden har helt rett, men de fleste besøkende vil nok likevel stusse over forakten i stemmen hennes. Det er vanligvis positivt at folk smiler og snakker med besøkende. Det er vanligvis sjarmerende når folk snakker det lokale språket, spesielt når det er så fullt av skarpe x’er og godt humør som gallego.</p><p>Det guiden prøver å si, med utpreget britisk aksent, er at fiskeindustri, landbruk og en stor Citroën-fabrikk har gitt hele området et preg av blå snipper og stolthet uten hemmeligheter.</p><p>I Vigo er veiene brolagt med fisk. Fiskeriindustrien har betalt for infrastrukturen, for bygningene og for innbyggernes inntekt. Langs kyststripen ligger fiskeforedlingsbedriftene tettere enn strandhotellene på Costa del Sol, og hele havneområdet stinker fisk.</p><figure class="post__image"><figure class="post__image post__image--center"><img loading="lazy" src="https://christian.nordtomme.com/media/posts/14/Galicia8.jpg" alt="" width="500" height="317" sizes="100vw" srcset="https://christian.nordtomme.com/media/posts/14/responsive/Galicia8-xs.jpg 300w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia8-sm.jpg 480w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia8-md.jpg 768w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia8-lg.jpg 1024w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia8-xl.jpg 1360w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia8-2xl.jpg 1600w"></figure><figcaption>I Vigo er veiene brolagt med fisk. Fiskeriindustrien har betalt for infrastrukturen, for bygningene og for innbyggernes inntekt. <em>Foto: Truls Nordberg</em> </figcaption></figure><p>Tidlig om morgenen yrer halvparten av byen med gamle og unge fiskehandlere som bærer tomme fiskekasser til, og triller tunge lass fra, fiskemarkedet på kaia. Det industrielle, grå og rustrøde, men likevel sjarmerende Vigo er for så vidt en utypisk del av Galicia på mange måter. Provinsen er tross alt en del av ”det grønne Spania.”</p><p>Men om farger og lukter forandrer seg med landskapet, så endrer det ikke konklusjonen: Galicia er ikke stedet for kultursnobber med god luktesans.</p><p>Santiago de Compostella, provinsens politiske og religiøse hovedstad, er slik sett ikke den rake motsetningen til Vigo byen kan virke som. De gamle, brolagte gatene som tvinger seg frem mellom koselige restauranter, romantiske svalganger og små butikker er blitt tråkket opp i hundrevis av år av svette pilegrimer fra all verdens kristne avkroker. Pilegrimenes mål, det første stedet de besøker etter å ha vandret tre dager eller mer gjennom nordspansk klima, er den overdådige katedralen byen deler sitt navn med.</p><p>Den som går inn i helligdommen med minner fra tidligere besøkte katedraler – svale, sakrale, med svak eim av stearin og mugg – kan vente seg en overraskelse. Det sørger tusener av uvaskede ryggsekkturister for. At katedralen i Santiago er i besittelse av verdens største røkelseskar er ingen tilfeldighet. Lukten av svette og fisk er i seg selv ikke spesielt tiltrekkende.</p><p>Likevel gjenspeiler det et upyntet Spania, en tilværelse der alt er hva det utgir seg for å være, og det er forfriskende. Maten er et godt eksempel. Den mest typiske tapas-varianten for regionen er blekksprut som så vidt er dyppet i kokende vann før den serveres med salt på en trefjøl. Veldig enkelt og veldig godt.</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://christian.nordtomme.com/media/posts/14/Galicia5.jpg" alt="" width="411" height="282" sizes="100vw" srcset="https://christian.nordtomme.com/media/posts/14/responsive/Galicia5-xs.jpg 300w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia5-sm.jpg 480w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia5-md.jpg 768w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia5-lg.jpg 1024w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia5-xl.jpg 1360w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia5-2xl.jpg 1600w"></figure><figcaption>At katedralen i Santiago er i besittelse av verdens største røkelseskar er ingen tilfeldighet. Lukten av svette og fisk er i seg selv ikke spesielt tiltrekkende.<em>Foto: Truls Nordberg</em></figcaption></figure><p></p><h3>Turismo rural</h3><p>Slik er Galicia. Enkelt og greit. Selv severdighetene er enkle: gamle borger som er blitt museer, gamle herskapshus som er blitt museer, gamle kirker som er forlatt eller er blitt museer, og gamle museer som sliter med besøkstallene.</p><p>Med hederlig unntak av en overdådig katedral, så er Galicia full av severdigheter man ser når man er her, og ikke severdigheter man er her for å se. Man kommer nemlig til Galicia for å slappe av med det enkle.</p><p>Spanjolene selv har lenge forstått hva landsdelen handler om, og har skapt behovet for galisiske bed&amp;breakfast. Rundt på landsbygda finnes små gårder og hus hvor eierne åpner dørene for urbane folk som bare vil slippe unna en liten stund.</p><p>Noen av disse husene har bare to-tre gjesterom, mens andre nesten er industrielt koselige med 12-14 rom, med eller uten eget bad. Disse rommene bruker turistene som baser for turer i skogen, utflukter til små landsbyer og deres markeder, eller picnicer på en av strendene som fremdeles ikke er ødelagt.</p><p>I det siste har noen få tyskere og franskmenn også sett sjarmen av å feriere på et sted der vertskapet gjerne inviterer dem til å dele en flaske vin, eller til å være med å lage et måltid. Det er imidlertid ikke høylydte mennesker som først og fremt tiltrekkes av denne typen ferie, og det er ikke flere av dem enn at stemningen i området forblir hjemmekoselig og rolig.</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://christian.nordtomme.com/media/posts/14/Galicia6-3.jpg" alt="" width="394" height="252" sizes="100vw" srcset="https://christian.nordtomme.com/media/posts/14/responsive/Galicia6-3-xs.jpg 300w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia6-3-sm.jpg 480w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia6-3-md.jpg 768w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia6-3-lg.jpg 1024w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia6-3-xl.jpg 1360w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia6-3-2xl.jpg 1600w"></figure><figcaption>Galicia er et upyntet Spania, en tilværelse der alt er hva det utgir seg for å være, og det er forfriskende. <em>Foto: Truls Nordberg</em></figcaption></figure><p></p><h3>Mytisk stemning</h3><p>Følelsen av Galicia kan like lite forstyrres av et par lavmælte utlendinger, som den kan druknes i råolje.</p><p>Ikke misforstå; Prestige var en økologisk og økonomisk katastrofe som har merket denne grønne fliken av Spania langt inn i fremtiden. Det skal imidlertid mer til enn en skipslast med olje til for å fjerne stemningen som hviler over regionen. Den ligger tykk som tåken i dalene her, og er å finne i de keltiske ruinene som kroner bakketoppene i området og i de ensomme korsene og kirkene som er blitt reist på disse ”hedenske” plassene.</p><p>Kanskje stemmer det, som lokalbefolkningen sverger på, at den galisiske stemningen er nedarvet fra de gamle kelterne som pleide å bo her for tusenvis av år siden, i tiden før og under romersk herredømme. Det virker imidlertid litt usannsynlig at kelternes innflytelse skulle være så sterk at områdets til tider eventyraktige stemning skulle være deres skyld.</p><p>Da er det lettere å tro at alle de tomme kirkene har noe med saken å gjøre. Det er faktisk et stort problem i Galicia at det er ikke er nok prester til kirkene – for det er kirker overalt. Men selv ikke kirkene virker viktige nok til å kunne forklare det mystiske Galicia. Kanskje er det underlige skygger i skumringstimene i skogen, og slørete konturer i det disige, noen ganger regnfulle, klimaet som gjør at landsdelen virker litt romantisk.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://christian.nordtomme.com/media/posts/14/Galicia4.jpg" alt="" width="500" height="337" sizes="100vw" srcset="https://christian.nordtomme.com/media/posts/14/responsive/Galicia4-xs.jpg 300w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia4-sm.jpg 480w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia4-md.jpg 768w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia4-lg.jpg 1024w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia4-xl.jpg 1360w, https://christian.nordtomme.com/media/posts/14/responsive/Galicia4-2xl.jpg 1600w"><figcaption>Det er faktisk et stort problem i Galicia at det er ikke er nok prester til kirkene – for det er kirker overalt. <em>Foto: Truls Nordberg</em></figcaption></figure><p>Det kan ikke være skogene heller, for stemningen er også å finne blant de gamle enkene som åpner østers i en liten gate i Vigos havnekvarter, blant fiskehandlerne på markedet og blant de splitter nye Citroën’ene som står på kaia og venter på neste båt.</p><p>Stemningen ligger i lukten av regn som nettopp har sluttet å falle, av fuktig skog, av traktordiesel, av blomstrende trær, av fiskeslo, av nydelige matretter, av svette og, ikke minst, i blandingen av alle luktene.</p><p>Men aller mest ligger stemningen av Galicia i lokalbefolkningens stolthet over selv den mest sviende av disse luktene. Uansett hvor vakkert eller slitent eller mystisk eller uparfymert Galicia er, så er det først og fremst galisieres hjem og arbeidsplass du besøker. Her jobber de hardt, bor godt og er stolte av det.</p><h4>Les mer:</h4><ul><li><a href="https://christian.nordtomme.com/det-gode-liv-i-galicia/">Det gode liv i Galicia</a></li></ul></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on September 13, 2023</p><ul class="post__tag"><li><a href="https://christian.nordtomme.com/tags/journalism/">Journalism</a></li><li><a href="https://christian.nordtomme.com/tags/norwegian/">På Norsk</a></li><li><a href="https://christian.nordtomme.com/tags/writing/">Writing</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fchristian.nordtomme.com%2Fdet-uparfymerte-spania%2F" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://christian.nordtomme.com/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fchristian.nordtomme.com%2Fdet-uparfymerte-spania%2F&amp;via=%40nordtomme&amp;text=Det%20uparfymerte%20Spania" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://christian.nordtomme.com/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span></a></div><div class="post__bio bio"><div><h3 class="bio__name"><a href="https://christian.nordtomme.com/authors/chris-k-n/" rel="author">Chris K. N.</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://christian.nordtomme.com/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://christian.nordtomme.com/legislation-regulation-and-documentation/" class="post__nav-link" rel="prev"><span>Previous</span> Legislation, Regulation &amp; Documentation</a></div><div class="post__nav-next"><a href="https://christian.nordtomme.com/det-gode-liv-i-galicia/" class="post__nav-link" rel="next"><span>Next</span> Det gode liv i Galicia </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://christian.nordtomme.com/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>© Copyright 2001–2023 Christian K. Nordtomme</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://christian.nordtomme.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://christian.nordtomme.com/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality.</div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" aria-level="2" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies.</div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Required</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Required</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Analytics</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-1" checked="checked"> <label for="pcb-group-1">Analytics</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>